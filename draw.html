<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Draw - Perfect Alignment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; padding: 25px 0; border-bottom: 2px solid rgba(255, 255, 255, 0.1); margin-bottom: 30px; }
        
        .draw-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .panel { 
            background: rgba(255, 255, 255, 0.08); border-radius: 15px; padding: 30px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); backdrop-filter: blur(10px); 
        }

        .section-title { font-size: 1.8rem; margin-bottom: 20px; color: #4bcffa; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        
        .group-selection { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .group-btn { 
            background: rgba(255,255,255,0.05); border: 2px solid transparent; border-radius: 10px; 
            padding: 15px 5px; text-align: center; cursor: pointer; transition: 0.3s; font-weight: bold; color: white;
        }
        .group-btn.active { background: rgba(75, 207, 250, 0.3); border-color: #4bcffa; transform: scale(1.05); }
        .group-btn.completed { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; cursor: not-allowed; opacity: 0.8; }

        .wheel-container { position: relative; width: 420px; height: 420px; margin: 20px auto; }
        #wheel { 
            width: 100%; height: 100%; border-radius: 50%; position: relative; 
            transition: transform 4s cubic-bezier(0.1, 0, 0.15, 1); border: 8px solid #fff;
            box-shadow: 0 0 30px rgba(0,0,0,0.4);
            overflow: hidden;
            background: #0d47a1;
        }

        /* NEW CENTERED LABEL LOGIC */
        .wheel-label {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: right; /* Align text to the "end" of the radius */
            padding-right: 40px; /* Distance from the outer edge */
            display: flex;
            align-items: center;
            justify-content: flex-end;
            transform-origin: 50% 50%; /* Rotate around wheel center */
            pointer-events: none;
            z-index: 2;
        }

        .label-text {
            display: inline-block;
            font-weight: 800;
            font-size: 12px;
            text-transform: uppercase;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            white-space: nowrap;
            /* This ensures text stays upright relative to the radius */
            transform: rotate(0deg); 
        }

        .wheel-center {
            position: absolute; width: 60px; height: 60px; background: white; border-radius: 50%;
            top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center; color: #333;
        }

        .pointer { 
            position: absolute; width: 44px; height: 44px; background: #f44336; 
            top: -22px; left: 50%; transform: translateX(-50%); 
            clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 20; 
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .spin-btn { 
            width: 100%; padding: 18px; background: #4CAF50; color: white; border: none; 
            border-radius: 50px; font-size: 1.3rem; font-weight: bold; cursor: pointer; margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: 0.2s;
        }
        .spin-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .group-card { background: rgba(0,0,0,0.2); border-radius: 10px; overflow: hidden; min-height: 120px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; }
        .group-header { padding: 10px; text-align: center; background: rgba(0,0,0,0.4); color: #ffd32a; font-weight: bold; }
        .group-teams { padding: 10px; }
        .team-entry { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; border-left: 4px solid #4bcffa; }
        
        .teams-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .pool-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; text-align: center; border: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; }
        .pool-item.used { opacity: 0.2; text-decoration: line-through; }

        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .popup-content { background: #1a237e; padding: 40px; border-radius: 20px; border: 3px solid #ffd32a; text-align: center; max-width: 450px; width: 90%; }
        .popup-team { font-size: 2.8rem; color: #ffd32a; margin: 20px 0; font-weight: 900; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .confirm { background: #4CAF50; color: white; }
        .cancel { background: #f44336; color: white; }

        @media (max-width: 1000px) { .draw-layout { grid-template-columns: 1fr; } .wheel-container { width: 320px; height: 320px; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üèÜ Tournament Draw 2024</h1>
        <p>10 Teams | Precision Alignment | Balanced Spins</p>
    </header>

    <div class="draw-layout">
        <section class="panel">
            <h2 class="section-title">1. Draw</h2>
            <div class="group-selection">
                <div class="group-btn" data-group="bye">BYE<br><small id="byeCount">0/1</small></div>
                <div class="group-btn" data-group="A">GRP A<br><small id="groupACount">0/3</small></div>
                <div class="group-btn" data-group="B">GRP B<br><small id="groupBCount">0/3</small></div>
                <div class="group-btn" data-group="C">GRP C<br><small id="groupCCount">0/3</small></div>
            </div>

            <div class="wheel-container">
                <div class="pointer"></div>
                <div id="wheel"></div>
                <div class="wheel-center"><i class="fas fa-star"></i></div>
            </div>

            <button class="spin-btn" id="spinBtn" disabled>SPIN THE WHEEL</button>
            <p id="statusLabel" style="text-align: center; margin-top: 15px; color: #4bcffa;">Select a group to start</p>
        </section>

        <section class="panel">
            <h2 class="section-title">2. Allocation</h2>
            <div class="group-card"><div class="group-header">Bye Slot</div><div class="group-teams" id="list-bye"></div></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="group-card"><div class="group-header">Group A</div><div class="group-teams" id="list-A"></div></div>
                <div class="group-card"><div class="group-header">Group B</div><div class="group-teams" id="list-B"></div></div>
            </div>
            <div class="group-card"><div class="group-header">Group C</div><div class="group-teams" id="list-C"></div></div>
        </section>
    </div>

    <section class="panel" style="margin-top: 30px;">
        <h2 class="section-title">Available Pool</h2>
        <div class="teams-grid" id="poolDisplay"></div>
    </section>
</div>

<div class="popup-overlay" id="popup">
    <div class="popup-content">
        <h2 style="color: white;">WINNER</h2>
        <div class="popup-team" id="pickedTeamName">TEAM NAME</div>
        <p>Assigning to: <span id="pickedGroupName" style="color: #4bcffa; font-weight: bold;"></span></p>
        <div class="popup-btns" style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn confirm" id="confirmAlloc">CONFIRM</button>
            <button class="btn cancel" id="cancelAlloc">RE-SPIN</button>
        </div>
    </div>
</div>

<script>
    const teamData = ["Club Eram", "Eram Talent", "Eram Strikers", "Kaku World", "Club United A", "Club United B", "Team Dar As Sihha", "Team Eram Hydraulics", "Team Epec", "Team ITL"];
    let available = [...teamData];
    let groups = { bye: [], A: [], B: [], C: [] };
    let activeGroup = null;
    let pickedTeam = null;
    let currentDeg = 0;

    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');

    function updateUI() {
        document.getElementById('poolDisplay').innerHTML = teamData.map(t => 
            `<div class="pool-item ${available.includes(t) ? '' : 'used'}">${t}</div>`
        ).join('');

        ['bye', 'A', 'B', 'C'].forEach(g => {
            const limit = g === 'bye' ? 1 : 3;
            document.getElementById(`${g === 'bye' ? 'bye' : 'group' + g}Count`).innerText = `${groups[g].length}/${limit}`;
            document.getElementById(`list-${g}`).innerHTML = groups[g].map(t => `<div class="team-entry">${t}</div>`).join('');
            const btn = document.querySelector(`[data-group="${g}"]`);
            if (groups[g].length >= limit) btn.classList.add('completed');
        });

        renderWheel();
    }

    function renderWheel() {
        if (available.length === 0) {
            wheel.style.background = "#222";
            wheel.innerHTML = "";
            return;
        }
        
        const count = available.length;
        const slice = 360 / count;
        
        let gradientParts = [];
        available.forEach((_, i) => {
            const color = i % 2 === 0 ? '#0d47a1' : '#1976d2';
            gradientParts.push(`${color} ${i * slice}deg ${(i + 1) * slice}deg`);
        });
        
        wheel.style.background = `conic-gradient(${gradientParts.join(', ')})`;
        
        wheel.innerHTML = available.map((t, i) => {
            const rotation = (i * slice) + (slice / 2);
            return `
                <div class="wheel-label" style="transform: rotate(${rotation}deg)">
                    <span class="label-text">${t}</span>
                </div>`;
        }).join('');
    }

    document.querySelectorAll('.group-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const g = btn.dataset.group;
            if (groups[g].length >= (g === 'bye' ? 1 : 3)) return;
            document.querySelectorAll('.group-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeGroup = g;
            spinBtn.disabled = false;
        });
    });

    spinBtn.addEventListener('click', () => {
        if (!activeGroup) return;
        spinBtn.disabled = true;

        const count = available.length;
        const sliceWidth = 360 / count;

        const winnerIndex = Math.floor(Math.random() * count);
        pickedTeam = available[winnerIndex];

        // PRECISION MATH:
        // Pointer is at 270 degrees.
        // We calculate exactly where the center of the slice is and rotate the wheel
        // so that specific center point lands at 270.
        const sliceCenter = (winnerIndex * sliceWidth) + (sliceWidth / 2);
        const targetBase = (270 - sliceCenter + 360) % 360;

        // Jitter is strictly limited to +/- 5% of slice width to avoid landing on edges
        const jitter = (Math.random() - 0.5) * (sliceWidth * 0.001);

        const extraSpins = 8 * 360; 
        const currentRotationNormalized = currentDeg % 360;
        const rotationNeeded = (targetBase - currentRotationNormalized + 360) % 360;
        
        currentDeg += extraSpins + rotationNeeded + jitter;

        wheel.style.transform = `rotate(${currentDeg}deg)`;

        setTimeout(() => {
            document.getElementById('pickedTeamName').innerText = pickedTeam;
            document.getElementById('pickedGroupName').innerText = activeGroup.toUpperCase();
            document.getElementById('popup').style.display = 'flex';
        }, 4100);
    });

    document.getElementById('confirmAlloc').addEventListener('click', () => {
        groups[activeGroup].push(pickedTeam);
        available = available.filter(t => t !== pickedTeam);
        document.getElementById('popup').style.display = 'none';
        activeGroup = null;
        document.querySelectorAll('.group-btn').forEach(b => b.classList.remove('active'));
        spinBtn.disabled = true;
        updateUI();
    });

    document.getElementById('cancelAlloc').addEventListener('click', () => {
        document.getElementById('popup').style.display = 'none';
        spinBtn.disabled = false;
    });

    updateUI();
</script>

</body>
</html>